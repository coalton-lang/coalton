;;;; settings.lisp
;;;;
;;;; This file contains variables that can be used to control how
;;;; Coalton works.

(in-package #:coalton-impl)

(deftype interaction-mode ()
  `(member :development :release))
(declaim (type interaction-mode *interaction-mode*))


;; *interaction-mode* determines how redefinable code generated by Coalton is.
;;
;; In development mode Coalton turns all declare-type forms into CLOS
;; objects to support a repl based workflow.
;;
;; In release mode Coalton compiles declare-type forms into frozen
;; structs or even more optimal layouts which may not support
;; redefinition.
;;
;; This variable *must* be set before the standard library is loaded.
;; Coalton defaults to development mode but switches to release mode
;; if the environment variable COALTON_ENV is set to release.
(defvar *interaction-mode* :development)

(when (string-equal (uiop:getenv "COALTON_ENV") "release")
  (format t ";; COALTON starting in release mode~%")
  (setf *interaction-mode* ':release))

